# Momo代理功能更新日志

## 更新内容

### 1. 代理API适配
- **新的代理API格式**: `http://bapi.51daili.com/getapi2?linePoolIndex=-1&packid=2&time=1&qty=1&port=1&format=txt&dt=2&dtc=1&usertype=17&uid=59521`
- **参数变更**: 将`dt=4`改为`dt=2`，适配新的代理格式

### 2. 错误处理和调试输出增强

#### jl_api方法改进
- ✅ 添加完整的错误处理（超时、连接错误、格式错误等）
- ✅ 增加详细的调试输出，包括：
  - API请求URL
  - 获取到的代理IP
  - 代理配置详情
  - 错误信息详细记录
- ✅ 添加代理格式验证（IP:端口格式）
- ✅ 添加端口数字验证

#### str_trans_to_md5方法改进
- ✅ 添加循环进度调试信息
- ✅ 添加代理获取失败的跳过机制
- ✅ 增强分享链接验证
- ✅ 添加每次循环的详细状态输出

#### run方法改进
- ✅ 添加请求状态码检查
- ✅ 添加响应内容预览
- ✅ 增强异常处理（超时、代理错误、连接错误）
- ✅ 添加关键词查找调试信息

### 3. 新增测试工具
- **test_proxy.py**: 独立的代理功能测试脚本
- 支持代理API测试
- 支持代理可用性验证

### 4. 新增功能：自动IP白名单

#### 功能说明
程序启动时会自动检测本地公网IP，并将其添加到代理服务商的白名单中，避免IP被封禁。

#### 白名单API
- **接口地址**: `http://aapi.51daili.com/whiteIP-list`
- **参数**:
  - `op=add`: 添加操作
  - `appkey=DAD44680B293374839DCE7B55FADEB5259521`: 应用密钥
  - `whiteip=您的ip`: 需要添加的IP地址

### 5. 新增功能：GUI美化和运行次数自定义

#### 界面改进
- **全新现代化界面设计** - 采用扁平化设计风格
- **窗口标题更新** - 改为"Momo代理工具 v2.0"
- **窗口大小优化** - 调整为600x400，更好的显示效果
- **颜色主题** - 使用舒适的配色方案
- **字体优化** - 使用Arial字体，提升可读性
- **组件分组** - 使用LabelFrame分组显示，更清晰
- **进度百分比** - 实时显示完成百分比
- **按钮美化** - 提升用户体验
- **滚动条** - 日志区域添加滚动条，方便查看历史记录

#### 运行次数自定义
- **可配置运行次数** - 用户可在GUI界面输入运行次数（1-1000次）
- **实时进度显示** - 进度条和百分比标签实时更新
- **动态进度条** - 根据输入的运行次数自动调整最大值
- **防重复点击** - 运行过程中禁用按钮，防止重复操作

#### 代理地址自定义
- **可配置代理地址** - 用户可在GUI界面输入自定义代理API地址
- **默认地址** - 预填默认代理地址，支持一键修改
- **地址验证** - 运行时检查代理地址是否为空
- **灵活配置** - 支持不同代理服务商的API格式

## 使用方法

### 运行主程序
```bash
python momo_proxy_useful.py
```

### 界面操作步骤
1. 在"分享链接"输入框中输入Momo分享链接
2. 在"运行配置"中设置运行次数（默认35次）
3. 点击"开始运行"
4. 查看"运行日志"了解实时状态
5. 如需手动添加IP白名单，点击"添加IP白名单"

### 测试代理功能
```bash
python test_proxy.py
```

### 测试白名单功能
```bash
python -c "
import sys
sys.path.append('Momo')
from momo_proxy_useful import MY_GUI
import tkinter as tk
root = tk.Tk()
gui = MY_GUI(root)
gui.add_white_ip()
"
```

## 调试信息说明

程序运行时会在控制台输出以下调试信息：
- `DEBUG`: 详细的执行过程信息
- `INFO`: 一般状态信息
- `WARNING`: 警告信息（如代理获取失败）
- `ERROR`: 错误信息
- `SUCCESS`: 成功完成信息

## 错误排查

如果遇到问题，请检查：
1. 网络连接是否正常
2. 代理API是否可访问
3. 控制台输出的详细错误信息
4. 分享链接格式是否正确（必须以https://www.maimemo.com开头）
5. IP白名单是否添加成功（启动时会显示相关信息）
6. 运行次数设置是否合理（1-1000之间）